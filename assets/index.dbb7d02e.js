var t=Object.defineProperty,e=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);import{j as s,p as i}from"./vendor.3c737b28.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class n{constructor(t){for(e(this,"radians");t<0;)t+=2*Math.PI;for(;t>=2*Math.PI;)t-=2*Math.PI;this.radians=t}static fromRadians(t){return new n(t)}static fromDegrees(t){const e=t*(Math.PI/180);return new n(e)}get degrees(){return this.radians*(180/Math.PI)}add(t){return n.fromRadians(this.radians+t.radians)}subtract(t){return n.fromRadians(this.radians-t.radians)}invert(){return n.fromRadians(-this.radians)}}class o{constructor(t,s){e(this,"x"),e(this,"y"),e(this,"inSameDirection",(t=>this.dot(t)>0)),e(this,"antiClockwiseAngleTo",(t=>n.fromRadians(t.angle.radians-this.angle.radians))),e(this,"leftOf",(t=>t.antiClockwiseAngleTo(this).degrees<180)),e(this,"clone",(()=>new o(this.x,this.y))),this.x=t,this.y=s}static fromTo(t,e){const s=e.x-t.x,i=e.y-t.y;return new o(s,i)}get length(){return(this.x**2+this.y**2)**.5}rotateClockwise(t){const e=this.x,s=this.y,i=t.radians,n=Math.cos(i)*e-Math.sin(i)*s,r=Math.sin(i)*e+Math.cos(i)*s;return new o(n,r)}rotateClockwiseAroundVector(t,e){return this.subtract(e).rotateClockwise(t).add(e)}setLength(t){if(0===this.length)return console.warn("Trying to set length of a vector with zero length"),new o(0,t);const e=t/this.length,s=this.x*e,i=this.y*e;return new o(s,i)}dot(t){return this.x*t.x+this.y*t.y}projectOn(t){const e=this.dot(t)/t.length;return t.setLength(e)}add(t){return new o(this.x+t.x,this.y+t.y)}subtract(t){return new o(this.x-t.x,this.y-t.y)}scale(t){const e=this.x*t,s=this.y*t;return new o(e,s)}get angle(){return n.fromRadians(Math.atan2(this.y,this.x)+Math.PI/2)}static sum(t){const{x:e,y:s}=t.reduce(((t,e)=>(t.x+=e.x,t.y+=e.y,t)),{x:0,y:0});return new o(e,s)}static merge(t){return o.sum(t).scale(1/t.length)}merge(t,e){return this.scale(1-e).add(t.scale(e))}rotateClockwiseM(t){const e=this.x,s=this.y,i=t.radians;return this.x=Math.cos(i)*e-Math.sin(i)*s,this.y=Math.sin(i)*e+Math.cos(i)*s,this}}class r{}e(r,"Repeat",(function*({makeGenerator:t,times:e}){for(let s=0;s<e;s++)yield*t()})),e(r,"parallelRace",(function*(t){let e=t.map((t=>t.next()));for(;!e.some((t=>t.done));)yield,e=t.map((t=>t.next()))})),e(r,"parallelAll",(function*(t){let e=t.map((t=>t.next()));for(;!e.every((t=>t.done));)yield,e=t.map((t=>t.next()))}));const a=t=>{if(void 0!==t.wait){const{wait:e}=t;return{type:"wait",frames:e}}if((t=>void 0!==t.spawn)(t)){const{spawn:e,x:s,y:i,actions:n}=t;return{type:"spawn",enemy:e,x:s,y:i,actions:n}}if((t=>void 0!==t.repeat)(t)){const{repeat:e,actions:s}=t;return{type:"repeat",times:e,actions:s}}if((t=>void 0!==t.parallelAll)(t)){const{parallelAll:e}=t;return{type:"parallelAll",actionsLists:e}}if((t=>void 0!==t.parallelRace)(t)){const{parallelRace:e}=t;return{type:"parallelRace",actionsLists:e}}if((t=>void 0!==t.attr)(t)){const{attr:e,is:s,yes:i,no:n}=t;return{type:"attr",attrName:e,is:s,yes:i,no:n}}if((t=>void 0!==t.setShotSpeed)(t)){const{setShotSpeed:e}=t;return{type:"setShotSpeed",pixelsPerFrame:e}}if(void 0!==t.moveToAbsolute){const{moveToAbsolute:e,frames:s}=t;return{type:"moveToAbsolute",moveTo:e,frames:s}}return(t=>void 0!==t.do)(t)?{type:"do",acns:t.do}:(t=>void 0!==t.seq)(t)?{type:"do",acns:t.seq.flat()}:(t=>void 0!==t.setSpeed)(t)?{type:"setSpeed",pixelsPerFrame:t.setSpeed}:(t=>void 0!==t.forever)(t)?{type:"repeat",times:1e8,actions:t.forever}:(t=>void 0!==t.twice)(t)?{type:"repeat",times:2,actions:t.twice}:(t=>void 0!==t.thrice)(t)?{type:"repeat",times:3,actions:t.thrice}:(t=>void 0!==t.fork)(t)?{type:"fork",actions:t.fork}:t},h=[2.35],l="1",c="2",d="0",m="1";class p{constructor(t){e(this,"input"),e(this,"gamepad"),e(this,"actionHandler"),e(this,"getPosition"),e(this,"getAttr"),e(this,"generators"),e(this,"shootPressed",(()=>this.input.ButtonsPressed.shoot||this.gamepad.shoot)),e(this,"laserPressed",(()=>this.input.ButtonsPressed.laser||this.gamepad.laser));const{actions:s,actionHandler:i,getPosition:n,getAttr:o,input:r,gamepad:a}=t;this.actionHandler=i,this.getPosition=n,this.getAttr=o,this.input=r,this.gamepad=a,this.generators=[this.makeGenerator(s)]}ProgressOneFrame(){const t=this.generators.length,e=this.generators.map((t=>t.next()));if(t===this.generators.length){return e.every((t=>t.done))}return!1}*makeGenerator(t=[]){var e,s,i,n,l,c;const d=t.map(a);let m=0;const p=d.length;for(;m<p;){const t=d[m];switch(t.type){case"moveAccordingToInput":{const t=this.input,e=this.gamepad;let s=h[0];const i=t.ButtonsPressed.left||e.left,n=t.ButtonsPressed.right||e.right,o=t.ButtonsPressed.up||e.up,r=t.ButtonsPressed.down||e.down,a=o||r;(i||n)&&a&&(s/=Math.SQRT2);let l=0,c=0;i&&(l-=s),n&&(l+=s),o&&(c-=s),r&&(c+=s),0===l&&0===c||this.actionHandler({type:"moveDelta",x:l,y:c});break}case"waitInputShoot":{const t=()=>this.shootPressed()&&!this.laserPressed();for(;!t();)yield;break}case"waitInputLaser":{const t=()=>this.laserPressed();for(;!t();)yield;break}case"waitUntilAttrIs":{const{attr:e,is:s}=t;for(;this.getAttr(e)!==s;)yield;break}case"fork":{const e=this.makeGenerator(t.actions);this.generators.push(e),e.next();break}case"do":yield*this.makeGenerator(t.acns);break;case"parallelRace":{const e=t.actionsLists.map((t=>this.makeGenerator(t)));yield*r.parallelRace(e);break}case"parallelAll":{const e=t.actionsLists.map((t=>this.makeGenerator(t)));yield*r.parallelAll(e);break}case"repeat":yield*r.Repeat({makeGenerator:()=>this.makeGenerator(t.actions),times:t.times});break;case"attr":{const{attrName:e,is:s,yes:i,no:n}=t,o=this.getAttr(e);yield*this.makeGenerator(o===s?i:n);break}case"waitNextFrame":yield;break;case"wait":for(let e=0;e<t.frames;e++)yield;break;case"waitTilInsideScreen":{const t=-20,e=377,s=-20,i=260,n=({x:n,y:o})=>n<t||n>e||o<s||o>i;for(;n(this.getPosition());)yield;break}case"waitTilOutsideScreen":{const t=-30,e=387,s=-30,i=270,n=({x:n,y:o})=>n<t||n>e||o<s||o>i;for(;!n(this.getPosition());)yield;break}case"move":{const i=null!=(e=t.x)?e:0,n=null!=(s=t.y)?s:0,o=i/t.frames,r=n/t.frames;for(let e=1;e<=t.frames;e++)this.actionHandler({type:"moveDelta",x:o,y:r}),yield;break}case"moveToAbsolute":{const e=this.getPosition(),{moveTo:s}=t,i=void 0!==s.x?s.x-e.x:0,n=void 0!==s.y?s.y-e.y:0,o=i/t.frames,r=n/t.frames;for(let a=1;a<=t.frames;a++)this.actionHandler({type:"moveDelta",x:o,y:r}),yield;break}case"rotate_around_relative_point":{const e=null!=(i=t.point.x)?i:0,s=null!=(n=t.point.y)?n:0,r=new o(-e,-s);yield*u(t,r,this.actionHandler);break}case"rotate_around_absolute_point":{const e=this.getPosition(),s=null!=(l=t.point.x)?l:e.x,i=null!=(c=t.point.y)?c:e.y,n=o.fromTo(new o(s,i),new o(e.x,e.y));yield*u(t,n,this.actionHandler);break}default:this.actionHandler(t)}m++}}}const u=function*(t,e,s){const i=t.degrees/t.frames;for(let r=1;r<=t.frames;r++){const t=i*(r-1),a=i*r,h=e.rotateClockwise(n.fromDegrees(t)),l=e.rotateClockwise(n.fromDegrees(a)),c=o.fromTo(h,l);s({type:"moveDelta",x:c.x,y:c.y}),yield}},y=class{constructor(t){e(this,"vector");const s=t.length;if(0===s)return void(this.vector=new o(0,1));const i=1/s,n=t.x*i,r=t.y*i;this.vector=new o(n,r)}get x(){return this.vector.x}get y(){return this.vector.y}rotateClockwise(t){const e=this.vector.x,s=this.vector.y,i=t.radians,n=Math.cos(i)*e-Math.sin(i)*s,r=Math.sin(i)*e+Math.cos(i)*s;return new y(new o(n,r))}toVector(){return new o(this.vector.x,this.vector.y)}static merge(t){const e=t.map((t=>t.toVector())),s=o.sum(e);return new y(s)}toVectorM(){return this.vector}};let g=y;e(g,"normalFromPositions",((t,e)=>{const s=o.fromTo(t,e);return new y(s).rotateClockwise(n.fromDegrees(90))}));let v=0;let f=0;const w={},x=function(t,e,s){return e&&0!==e.length?Promise.all(e.map((t=>{if((t=function(t){return"/"+t}(t))in w)return;w[t]=!0;const e=t.endsWith(".css"),s=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${s}`))return;const i=document.createElement("link");return i.rel=e?"stylesheet":"modulepreload",e||(i.as="script",i.crossOrigin=""),i.href=t,document.head.appendChild(i),e?new Promise(((e,s)=>{i.addEventListener("load",e),i.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${t}`))))})):void 0}))).then((()=>t())):t()};const S=()=>"undefined"!==typeof window,b=S()?new class{constructor(){e(this,"WithWindow",(t=>t(window))),e(this,"Alert",(t=>{window.alert(t)})),e(this,"PerformanceNow",(()=>window.performance.now())),e(this,"SetInterval",((t,e)=>window.setInterval(t,e))),e(this,"RequestAnimationFrame",(t=>window.requestAnimationFrame(t))),e(this,"FetchText",(async t=>{const e=await window.fetch(t);return await e.text()})),e(this,"FetchBinary",(async t=>{const e=await window.fetch(t);return await e.blob()}))}OnLoad(t){window.onload=t}}:new class{constructor(){e(this,"WithWindow",(t=>{})),e(this,"Alert",(t=>{throw console.log(t),new Error(t)})),e(this,"PerformanceNow",(()=>Date.now())),e(this,"SetInterval",((t,e)=>{for(let s=0;s<1e7;s++)t();return 0})),e(this,"RequestAnimationFrame",(t=>{for(let e=0;e<1e7;e++)t(0);return 0})),e(this,"FetchText",(async t=>{const{readFile:e}=await x((()=>import("./__vite-browser-external.aaa15d46.js")),[]);return(await e(t)).toString()})),e(this,"FetchBinary",(async t=>{const{readFile:e}=await x((()=>import("./__vite-browser-external.aaa15d46.js")),[]);let s;try{s=await e(t)}catch(i){s=await e("public"+t)}return s}))}OnLoad(t){t()}};class E{constructor(t){e(this,"value"),this.value=t;const s=typeof t;if("string"!==s&&"number"!==s&&"boolean"!==s)throw b.Alert(`Attribute.constructor: typeof value was "${s}" which is not an allowed type.`),new Error(`Attribute.constructor: typeof value was "${s}" which is not an allowed type.`)}}class I{constructor(){e(this,"attributes",{points:{value:10},pointsOnDeath:{value:0},hp:{value:1},maxHp:{value:1},collisionType:{value:"enemy"},boundToWindow:{value:!1}}),e(this,"getAndAssertAttribute",(t=>{if(!(t in this.attributes)){const e=`Attribute:  Attribute "${t}" does not exist.`;throw b.Alert(e),new Error(e)}return this.attributes[t]})),e(this,"SetAttribute",(t=>{const{name:e,value:s}=t;this.attributes[e]=new E(s)})),e(this,"UnsetAttribute",(t=>{this.getAndAssertAttribute(t),delete this.attributes[t]})),e(this,"GetAttribute",(t=>this.getAndAssertAttribute(t))),e(this,"attrExists",(t=>!!this.attributes[t])),e(this,"incr",(t=>{const e=this.getAndAssertAttribute(t);if("number"!=typeof e.value){const s=`Attribute.incr: Tried to increment ${t} which is of type ${typeof e.value}`;throw b.Alert(s),new Error(s)}e.value++})),e(this,"decr",(t=>{const e=this.getAndAssertAttribute(t);if("number"!=typeof e.value){const s=`Attribute.decr: Tried to decrement ${t} which is of type ${typeof e.value}`;throw b.Alert(s),new Error(s)}e.value--}))}}const k=t=>"number"==typeof t,A=t=>{if(!k(t)){const e=`assertNumber: ${JSON.stringify(t)} is not of type "number"`;throw b.Alert(e),new Error(e)}return t},C=t=>!!S()&&t instanceof window.HTMLDivElement,P=t=>!!S()&&t instanceof window.HTMLInputElement;class T{constructor(t){e(this,"graphics"),e(this,"gfxHandle"),e(this,"gfxHealth"),e(this,"setPosition",(({x:t,y:e})=>{this.graphics.Dispatch({type:"gfxSetPosition",handle:this.gfxHandle,x:t,y:e}),this.graphics.Dispatch({type:"gfxSetPosition",handle:this.gfxHealth,x:t,y:e})})),e(this,"release",(()=>{this.graphics.Dispatch({type:"gfxRelease",handle:this.gfxHandle}),this.graphics.Dispatch({type:"gfxRelease",handle:this.gfxHealth})})),e(this,"updateDisplayHealth",(t=>{this.graphics.Dispatch({type:"gfxSetScale",handle:this.gfxHealth,scale:1-t})})),e(this,"setRotation",(({degrees:t})=>{this.graphics.Dispatch({type:"gfxSetRotation",handle:this.gfxHandle,degrees:t}),this.graphics.Dispatch({type:"gfxSetRotation",handle:this.gfxHealth,degrees:t})})),e(this,"dispatch",(t=>{switch(t.type){case"gfxSetColor":this.graphics.Dispatch({...t,handle:this.gfxHandle});break;case"gfxSetDiameter":case"gfxSetPosition":case"gfxSetRotation":case"gfxSetShape":case"gfxSetScale":this.graphics.Dispatch({...t,handle:this.gfxHandle}),this.graphics.Dispatch({...t,handle:this.gfxHealth});break;default:b.Alert(`${t.type} not handled in EnemyGfx.dispatch!`)}}));const{graphics:s,x:i,y:n,diameter:o}=t;this.graphics=s,this.gfxHandle=this.graphics.Dispatch({type:"gfxAskForElement"}).handle,this.gfxHealth=this.graphics.Dispatch({type:"gfxAskForElement"}).handle,this.graphics.Dispatch({type:"gfxSetPosition",handle:this.gfxHandle,x:i,y:n}),this.graphics.Dispatch({type:"gfxSetPosition",handle:this.gfxHealth,x:i,y:n}),this.graphics.Dispatch({type:"gfxSetDiameter",handle:this.gfxHandle,diameter:o}),this.graphics.Dispatch({type:"gfxSetDiameter",handle:this.gfxHealth,diameter:o}),this.graphics.Dispatch({type:"gfxSetColor",handle:this.gfxHandle,color:"red"}),this.graphics.Dispatch({type:"gfxSetColor",handle:this.gfxHealth,color:"black"}),this.graphics.Dispatch({type:"gfxSetShape",handle:this.gfxHandle,shape:"diamondShield"}),this.graphics.Dispatch({type:"gfxSetShape",handle:this.gfxHealth,shape:"diamondShield"}),this.updateDisplayHealth(1)}}class D{constructor(t,s,i){e(this,"X"),e(this,"Y"),e(this,"id"),e(this,"enemies"),e(this,"graphics"),e(this,"diameter"),e(this,"speed",0),e(this,"shotSpeed",.2),e(this,"moveDirection",new g(new o(0,1))),e(this,"mirrorX",!1),e(this,"mirrorY",!1),e(this,"actionExecutor"),e(this,"gfx"),e(this,"attrs",new I),e(this,"name"),e(this,"OnFrameTick",(()=>{var t,e;this.actionExecutor.ProgressOneFrame(),this.attrs.GetAttribute("boundToWindow").value&&this.boundToWindow(),this.updateDisplayHealth(),null==(t=this.gfx)||t.setPosition({x:this.X,y:this.Y}),null==(e=this.gfx)||e.setRotation({degrees:this.moveDirection.toVector().angle.degrees})})),e(this,"OnCollisions",(t=>{const{enemiesThatWereHit:e}=t;if(e.includes(this.id)){const t=A(this.attrs.GetAttribute("points").value);this.enemies.eventsPoints.dispatchEvent({type:"add_points",points:t,enemy:this.name}),this.hp-=1,this.updateDisplayHealth(),this.hp<1&&this.die()}})),e(this,"boundToWindow",(()=>{const t=this.diameter/2;this.X<t?this.X=t:this.X>357-t&&(this.X=357-t),this.Y<t?this.Y=t:this.Y>240-t&&(this.Y=240-t)})),e(this,"die",(()=>{const t=this.enemies;t.enemies=t.enemies.filter((t=>t.id!==this.id));const e=A(this.attrs.GetAttribute("pointsOnDeath").value);0!==e&&this.enemies.eventsPoints.dispatchEvent({type:"add_points",enemy:this.name,points:e}),this.gfx&&(this.gfx.release(),this.gfx=void 0)})),e(this,"HandleAction",(t=>{var e;switch(t.type){case"shootDirection":this.ShootDirection({dirX:t.x,dirY:t.y});break;case"setSpeed":this.speed=t.pixelsPerFrame;break;case"setShotSpeed":this.shotSpeed=t.pixelsPerFrame;break;case"set_position":this.SetPosition({x:t.x,y:t.y});break;case"shoot_toward_player":this.ShootTowardPlayer();break;case"shoot_beside_player":this.ShootBesidePlayer(t.degrees);break;case"rotate_towards_player":this.RotateTowardsPlayer();break;case"setMoveDirection":this.setMoveDirection(t.degrees);break;case"move_according_to_speed_and_direction":this.moveAccordingToSpeedAndDirection();break;case"spawn":{const{enemy:e,x:s=0,y:i=0,actions:n}=t;this.spawn({enemy:e,pos:{x:s,y:i},actions:n});break}case"mirrorX":this.mirrorX=t.value;break;case"mirrorY":this.mirrorY=t.value;break;case"moveDelta":this.moveDelta({x:t.x,y:t.y});break;case"setAttribute":this.attrs.SetAttribute({name:t.attribute,value:t.value});break;case"die":this.die();break;case"incr":this.attrs.incr(t.attribute);break;case"decr":this.attrs.decr(t.attribute);break;default:null==(e=this.gfx)||e.dispatch(t)}})),e(this,"moveDelta",(({x:t=0,y:e=0})=>{this.X=this.mirrorX?this.X-t:this.X+t,this.Y=this.mirrorY?this.Y-e:this.Y+e})),e(this,"ShootDirection",(({dirX:t,dirY:e})=>{const s=0===t&&0===e,i=this.shotSpeed/(s?9999:Math.sqrt(t**2+e**2));this.spawn({enemy:"shot",pos:{x:0,y:0},actions:[{fork:[{forever:[{type:"moveDelta",x:t*i,y:e*i},{type:"waitNextFrame"}]}]}]})})),e(this,"ShootTowardPlayer",(()=>{const t=this.enemies.player,e=t.X-this.X,s=t.Y-this.Y;this.ShootDirection({dirX:e,dirY:s})})),e(this,"ShootBesidePlayer",(t=>{const e=this.enemies.player,s=e.X-this.X,i=e.Y-this.Y,r=new o(s,i).rotateClockwiseM(n.fromDegrees(t));this.ShootDirection({dirX:r.x,dirY:r.y})})),e(this,"SetPosition",(({x:t,y:e})=>{const s=this.getPosition(),i=new o(s.x,s.y),n=new o(t,e),r=o.fromTo(i,n);let a=r.x,h=r.y;this.mirrorX&&(a=-a),this.mirrorY&&(h=-h);const l=this.X+a,c=this.Y+h;this.X=l,this.Y=c})),e(this,"RotateTowardsPlayer",(()=>{const t=this.enemies.player,e=new o(t.X,t.Y),s=new o(this.X,this.Y),i=o.fromTo(s,e);this.moveDirection=new g(i)})),e(this,"setMoveDirection",(t=>{const e=new g(new o(0,-1)).rotateClockwise(n.fromDegrees(t));this.moveDirection=e})),e(this,"moveAccordingToSpeedAndDirection",(()=>{const t=this.X+this.moveDirection.x*this.speed,e=this.Y+=this.moveDirection.y*this.speed;this.X=t,this.Y=e})),e(this,"spawn",(({enemy:t,pos:e,actions:s})=>{const i={x:e.x+this.X,y:e.y+this.Y};this.enemies.Spawn({enemy:t,position:i,prependActions:s})})),e(this,"getPosition",(()=>{let t=this.X,e=this.Y;return this.mirrorX&&(t=357-t),this.mirrorY&&(e=240-e),{x:t,y:e}})),e(this,"getAttr",(t=>this.attrs.attrExists(t)&&this.attrs.GetAttribute(t).value)),e(this,"updateDisplayHealth",(()=>{var t;const e=this.hp/this.maxHp;null==(t=this.gfx)||t.updateDisplayHealth(e)})),this.enemies=t,this.id=`${i.name}-${v++}`,this.name=i.name,this.diameter=i.diameter,this.X=s.x,this.Y=s.y,this.actionExecutor=new p({actionHandler:this.HandleAction,actions:i.actions,getPosition:this.getPosition,getAttr:this.getAttr,input:this.enemies.input,gamepad:this.enemies.gamepad}),this.hp=i.hp,this.maxHp=i.hp,this.graphics=this.enemies.graphics,this.gfx=new T({diameter:i.diameter,graphics:this.graphics,x:this.X,y:this.Y}),this.OnFrameTick()}get hp(){return A(this.attrs.GetAttribute("hp").value)}set hp(t){this.attrs.SetAttribute({name:"hp",value:t})}get maxHp(){return A(this.attrs.GetAttribute("maxHp").value)}set maxHp(t){this.attrs.SetAttribute({name:"maxHp",value:t})}get Radius(){return this.diameter/2}}class H{constructor({name:t}){e(this,"name"),e(this,"enemies"),e(this,"memoizedPlayer"),e(this,"yaml"),e(this,"events"),e(this,"eventsPoints"),e(this,"graphics"),e(this,"input"),e(this,"gamepad"),e(this,"Init",(async t=>{this.events=null==t?void 0:t.events,this.eventsPoints=null==t?void 0:t.eventsPoints,this.yaml=null==t?void 0:t.yaml,this.graphics=null==t?void 0:t.graphics,this.input=null==t?void 0:t.input,this.gamepad=null==t?void 0:t.gamepad,this.Spawn({enemy:"spawner",position:{x:0,y:0}}),this.events.subscribeToEvent(this.name,this.handleEvent)})),e(this,"Spawn",(({enemy:t,position:e,prependActions:s=[]})=>{const i=this.yaml.GetEnemy(t);if(!i)throw b.Alert(`Unknown enemy "${t}".`),new Error(`Unknown enemy "${t}".`);const n={...i,actions:[{fork:[{type:"waitTilInsideScreen"},{type:"waitTilOutsideScreen"},{type:"die"}]},...s,...i.actions]};this.enemies.push(new D(this,e,n))})),e(this,"handleEvent",(t=>{switch(t.type){case"frame_tick":this.enemies.forEach((t=>{t.OnFrameTick()}));break;case"collisions":this.enemies.forEach((e=>{e.OnCollisions(t.collisions)}))}})),this.name=t,this.enemies=[]}get player(){if(void 0!==this.memoizedPlayer)return this.memoizedPlayer;const t=this.enemies.find((t=>"player"===t.attrs.GetAttribute("collisionType").value));if(void 0===t)throw new Error("Enemies.getPlayer: Player was not found");return this.memoizedPlayer=t,t}}const _=t=>`${t}px`;class L{constructor({app:t,name:s}){e(this,"app"),e(this,"name"),e(this,"startTime"),e(this,"framCounterDiv"),e(this,"elapsedTimeDiv"),e(this,"fpsDiv"),e(this,"Init",(async()=>{this.app.events.subscribeToEvent(this.name,this.handleEvent)})),e(this,"handleEvent",(t=>{if("frame_tick"!==t.type)return;null===this.startTime&&(this.startTime=b.PerformanceNow());const e=b.PerformanceNow()-this.startTime;if(C(this.elapsedTimeDiv)&&C(this.framCounterDiv)&&C(this.fpsDiv)){const s=t.frameNr;this.elapsedTimeDiv.innerHTML=`elapsed: ${((t,e=1)=>Math.round(t*10**e)/10**e)(e/1e3)}s`,this.framCounterDiv.innerHTML=`frames: ${s}`,this.fpsDiv.innerHTML=`fps: ${Math.round(s/(e/1e3))}`}})),this.app=t,this.name=s,this.framCounterDiv=b.WithWindow((t=>{const e=t.document.querySelector("#frameCounter");return e.style.position="fixed",e.style.top=_(240),e.style.left="0px",e.style.zIndex=c,e})),this.elapsedTimeDiv=b.WithWindow((t=>{const e=t.document.querySelector("#elapsedTimeDiv");return e.style.position="fixed",e.style.top=_(260),e.style.left="0px",e.style.zIndex=c,e})),this.fpsDiv=b.WithWindow((t=>{const e=t.document.querySelector("#fpsDiv");return e.style.position="fixed",e.style.top=_(280),e.style.left="0px",e.style.zIndex=c,e})),this.startTime=null}}class W{constructor({name:t}){e(this,"events"),e(this,"name"),e(this,"history"),e(this,"buttonsPressed",{start:!1,shoot:!1,laser:!1,left:!1,right:!1,up:!1,down:!1}),e(this,"onKeyUpCallback"),e(this,"frameCount",0),e(this,"Init",(async t=>{this.events=null==t?void 0:t.events,this.events.subscribeToEvent(this.name,(t=>{switch(t.type){case"frame_tick":this.frameCount=t.frameNr;break;case"player_died":console.log("Input.history:"),console.log(this.history)}}))})),e(this,"handleKey",((t,e)=>{switch(t.keyCode){case 13:return this.buttonsPressed.start=e,"start";case 32:return this.buttonsPressed.shoot=e,"shoot";case 17:return this.buttonsPressed.laser=e,"laser";case 37:return this.buttonsPressed.left=e,"left";case 38:return this.buttonsPressed.up=e,"up";case 39:return this.buttonsPressed.right=e,"right";case 40:return this.buttonsPressed.down=e,"down";default:return}})),e(this,"handleKeyDown",(t=>{this.handleKey(t,!0)})),e(this,"handleKeyUp",(t=>{var e;const s=this.handleKey(t,!1);void 0!==s&&(null==(e=this.onKeyUpCallback)||e.call(this,s))})),this.name=t,this.history={inputs:{},score:0},b.WithWindow((t=>{t.document.onkeydown=this.handleKeyDown,t.document.onkeyup=this.handleKeyUp}))}get ButtonsPressed(){const t=this.frameCount,e={...this.buttonsPressed};return Object.values(e).includes(!0)&&(Object.keys(e).forEach((t=>{"laser"!==t&&"shoot"!==t&&"up"!==t&&"down"!==t&&"left"!==t&&"right"!==t&&"start"!==t||!1===e[t]&&delete e[t]})),this.history.inputs[t]=e),this.buttonsPressed}}class F{constructor(t){e(this,"name"),e(this,"Init",(async()=>{})),e(this,"getPressedButton",(t=>!!S()&&b.WithWindow((e=>{var s,i;const n=e.navigator.getGamepads();if(n.length<1)return!1;const o=n[0];return!!o&&!!(null==(i=null==(s=o.buttons)?void 0:s[t])?void 0:i.pressed)})))),this.name=t.name,b.WithWindow((t=>{t.addEventListener("gamepadconnected",(function(t){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length)}))}))}get shoot(){return this.getPressedButton(0)}get laser(){return this.getPressedButton(1)}get left(){return this.getPressedButton(14)}get right(){return this.getPressedButton(15)}get up(){return this.getPressedButton(12)}get down(){return this.getPressedButton(13)}}class M{constructor(t){e(this,"name"),e(this,"events"),e(this,"enemies"),e(this,"Init",(async t=>{this.events=null==t?void 0:t.events,this.enemies=null==t?void 0:t.enemies,this.events.subscribeToEvent(this.name,(({type:t})=>{"frame_tick"===t&&this.update()}))})),e(this,"update",(()=>{const t=this.enemies.enemies.filter((t=>"enemy"===t.attrs.GetAttribute("collisionType").value)),e=[...this.enemies.enemies.filter((t=>"enemyBullet"===t.attrs.GetAttribute("collisionType").value)),...t],s=this.enemies.enemies.filter((t=>"playerBullet"===t.attrs.GetAttribute("collisionType").value)),i=this.enemies.player;this.calcCollisions({circle:i,shots:e}).collided&&this.events.dispatchEvent({type:"player_died"});const n=t.reduce(((t,e)=>{const i=this.calcCollisions({circle:e,shots:s});return i.collided?[...t,e.id,i.collidedWithId]:t}),[]);if(n.length>0){const t={enemiesThatWereHit:n};this.events.dispatchEvent({type:"collisions",collisions:t})}})),e(this,"calcCollisions",(({circle:t,shots:e})=>{for(let s=0;s<e.length;s++){const i=e[s],n=t.Radius+.8*i.Radius,o=t.X-i.X,r=t.Y-i.Y;if(Math.sqrt(o**2+r**2)<=n)return{collided:!0,collidedWithId:i.id}}return{collided:!1}})),this.name=t.name}}class G{constructor({app:t,name:s}){e(this,"app"),e(this,"name"),e(this,"subscribers"),e(this,"Init",(async()=>{})),e(this,"subscribeToEvent",((t,e)=>{this.subscribers[t]=e})),e(this,"unsubscribeToEvent",(t=>{delete this.subscribers[t]})),e(this,"dispatchEvent",(t=>{Object.values(this.subscribers).forEach((e=>{e(t)}))})),this.app=t,this.name=s,this.subscribers={}}}class ${constructor({name:t}){e(this,"name"),e(this,"gameSpeedElement"),e(this,"Init",(async()=>{})),this.name=t,this.gameSpeedElement=b.WithWindow((t=>{const e=t.document.querySelector("#speedUp");return e.style.position="fixed",e.style.top=_(240),e.style.right=_(357),e.value="1",e.style.zIndex=c,e}))}get GameSpeed(){if(P(this.gameSpeedElement)){const t=this.gameSpeedElement.value;return parseInt(t,10)}return 1}set GameSpeed(t){P(this.gameSpeedElement)&&(this.gameSpeedElement.value=`${t}`)}}class z{constructor({app:t,name:s}){e(this,"app"),e(this,"name"),e(this,"points"),e(this,"history"),e(this,"Init",(async()=>{this.app.events.subscribeToEvent(this.name,this.onEvent),this.app.eventsPoints.subscribeToEvent(this.name,this.onEvent)})),e(this,"onEvent",(t=>{switch(t.type){case"add_points":{this.points+=t.points;const e=this.app.gameLoop.FrameCount;this.history[e]={points:t.points,reason:t.enemy},this.updatePoints();break}case"player_died":this.app.events.unsubscribeToEvent(this.name),S()&&(console.log("Points.history:"),console.log(this.history))}})),e(this,"updatePoints",(()=>{this.app.eventsUi.dispatchEvent({type:"uiScoreUpdated",points:this.points})})),this.app=t,this.name=s,this.points=0,this.history={}}}class R{constructor({name:t,top10:s}){e(this,"name"),e(this,"top10",[{name:"A",score:10},{name:"B",score:9},{name:"C",score:8},{name:"D",score:7},{name:"E",score:6},{name:"F",score:5},{name:"G",score:4},{name:"H",score:3},{name:"I",score:2},{name:"J",score:1}]),e(this,"Init",(async t=>{b.WithWindow((t=>{const e=t.localStorage.getItem("__highscore");e?this.top10=JSON.parse(e):t.localStorage.setItem("__highscore",JSON.stringify(this.top10))}))})),e(this,"getTop1",(()=>this.top10[0])),e(this,"getTop10",(()=>this.top10)),e(this,"qualifiedForTop10",(t=>{let e,s=!1;for(let i=0;i<10;i++)if(t>this.top10[i].score){s=!0,e=i;break}return{qualifiedForTop10:s,rank:e}})),e(this,"registerNewEntry",(t=>{t.score=Math.round(t.score);const{rank:e}=this.qualifiedForTop10(t.score);void 0!==e&&(this.top10.splice(e,0,t),this.top10=this.top10.filter(((t,e)=>e<10)),b.WithWindow((t=>{t.localStorage.setItem("__highscore",JSON.stringify(this.top10))})))})),this.name=t,s&&(this.top10=s)}}class N{constructor({name:t}){e(this,"name"),e(this,"EnemyJsons"),e(this,"Init",(async()=>{var t;const e=await b.FetchBinary("/game.zip"),n=await s.exports.loadAsync(e),o=await(null==(t=n.file("common.yaml"))?void 0:t.async("text")),r=Object.keys(n.files);(await Promise.all(r.filter((t=>"common.yaml"!==t)).map((async t=>{var e;const s=await(null==(e=n.file(t))?void 0:e.async("text"));if(!s){const e=`Yaml: Failed to unzip ${t}`;throw b.Alert(e),new Error(e)}return s})))).reduce(((t,e)=>[...t,...e.split("---")]),[]).map((t=>{const e=o?`${o}\n${t}`:t,s=i(e,{merge:!0});return this.checkError(s),i(e,{merge:!0})})).forEach((t=>{const e=t.toJS();(null==e?void 0:e.enemy)?this.EnemyJsons[e.enemy.name]=e.enemy:console.error("Error: Yaml service: Trying to add an empty enemy. Skipping.")}))})),e(this,"GetEnemy",(t=>this.EnemyJsons[t])),e(this,"checkError",(t=>{const{errors:e}=t;if(e.length>0)throw b.Alert(JSON.stringify(e,null,2)),e})),this.name=t,this.EnemyJsons={}}}const O=class{constructor({name:t}){e(this,"name"),e(this,"elementPool"),e(this,"Init",(async()=>{})),e(this,"Dispatch",(t=>{switch(t.type){case"gfxAskForElement":return this.actionAskForElement();case"gfxSetPosition":return this.actionSetPosition(t);case"gfxSetDiameter":return this.actionSetDiameter(t);case"gfxRelease":return this.actionRelease(t);case"gfxSetColor":return this.actionSetColor(t);case"gfxSetShape":return this.actionSetShape(t);case"gfxSetRotation":return this.actionSetRotation(t);case"gfxSetScale":return this.actionSetScale(t);default:{const e=`unknown action type: ${t.type}`;throw b.Alert(e),new Error(e)}}})),e(this,"getRestingPlace",(t=>({x:377+10*Math.floor(t/10),y:20+10*(t%10)}))),e(this,"initElementPool",(()=>Array(O.poolSize).fill(0).map(((t,e)=>this.initOneElement(e))))),e(this,"reset",(t=>{const{x:e,y:s}=this.getRestingPlace(t.index),i=s-2.5,n=e-2.5;t.rotation=0,t.scale=1,t.element.style.position="fixed",t.element.style.boxSizing="border-box",t.element.style.backgroundColor="orange",t.element.style.width=_(5),t.element.style.height=_(5),t.element.style.top=_(i),t.element.style.left=_(n),t.element.style.zIndex=d,t.element.style.transform="rotate(0deg) scale(1)"})),e(this,"initOneElement",(t=>{const{x:e,y:s}=this.getRestingPlace(t),i=""+f++,n=s-2.5,o=e-2.5,r=b.WithWindow((t=>{const e=t.document.createElement("div");return e.id=i,e.style.position="fixed",e.style.boxSizing="border-box",e.style.backgroundColor="orange",e.style.width=_(5),e.style.height=_(5),e.style.top=_(n),e.style.left=_(o),e.style.zIndex=d,e.style.transform="rotate(0deg) scale(1)",t.document.body.appendChild(e),e}));return{handle:i,inUse:!1,element:r,index:t,shape:"circle",diameter:5,scale:1,rotation:0}})),e(this,"findExistingAndInUse",(t=>{const e=this.elementPool.find((e=>e.handle===t));if(!e)throw b.Alert(`Graphics: No GraphicsElement with handle "${t}"!`),new Error(`Graphics: No GraphicsElement with handle "${t}"!`);if(!e.inUse)throw b.Alert(`Graphics: Trying to set position for unused handle "${t}"!`),new Error(`Graphics: Trying to set position for unused handle "${t}"!`);return e})),e(this,"actionAskForElement",(()=>{const t=this.elementPool.find((t=>!t.inUse));if(t)return t.inUse=!0,{type:"responseAskForElement",handle:t.handle};throw b.Alert("Graphics: All elements are in use!"),new Error("Graphics: All elements are in use!")})),e(this,"actionSetPosition",(({handle:t,x:e,y:s})=>{const i=this.findExistingAndInUse(t),n=parseFloat(i.element.style.width)/2;return void 0!==e&&(i.element.style.left=_(e-n)),void 0!==s&&(i.element.style.top=_(s-n)),{type:"responseVoid"}})),e(this,"actionSetDiameter",(({handle:t,diameter:e})=>{const s=this.findExistingAndInUse(t),i=e/2-s.diameter/2,n=s.element.style;return n.width=_(e),n.height=_(e),n.left=_(parseFloat(n.left)-i),n.top=_(parseFloat(n.top)-i),s.diameter=e,{type:"responseVoid"}})),e(this,"actionRelease",(({handle:t})=>{const e=this.findExistingAndInUse(t);return this.reset(e),e.inUse=!1,{type:"responseVoid"}})),e(this,"actionSetColor",(({handle:t,color:e})=>(this.findExistingAndInUse(t).element.style.backgroundColor=e,{type:"responseVoid"}))),e(this,"actionSetShape",(({handle:t,shape:e})=>{const s=this.findExistingAndInUse(t);switch(e){case"none":s.element.style.clipPath="circle(0%)";break;case"circle":s.element.style.clipPath="circle(50%)";break;case"square":s.element.style.clipPath="none";break;case"triangle":s.element.style.clipPath="polygon(50% 0%, 100% 100%, 0% 100%)";break;case"diamondShield":s.element.style.clipPath="polygon(50% 0%,100.00% 80.00%,50% 100%,0.00% 80.00%)";break;case"octagon":s.element.style.clipPath="polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%)"}return s.shape=e,{type:"responseVoid"}})),e(this,"actionSetRotation",(({handle:t,degrees:e})=>{const s=this.findExistingAndInUse(t);return s.rotation=e,s.element.style.transform=`rotate(${s.rotation}deg) scale(${s.scale})`,{type:"responseVoid"}})),e(this,"actionSetScale",(({handle:t,scale:e})=>{const s=this.findExistingAndInUse(t);return s.scale=e,s.element.style.transform=`rotate(${s.rotation}deg) scale(${s.scale})`,{type:"responseVoid"}})),this.name=t,this.elementPool=this.initElementPool()}};let U=O;e(U,"poolSize",100);const Y=()=>b.WithWindow((t=>{const e=t.document.createElement("div");return e.style.position="fixed",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.top=_(0),e.style.left=_(0),e.style.width=_(357),e.style.height=_(240),e.style.zIndex=m,t.document.body.appendChild(e),e})),X=t=>{const e=t.offsetWidth/2;return t.style.left=_(178.5-e),t},B=t=>{const{text:e,fontSize:s=16,left:i,top:n,right:o,className:r="",color:a="red",onClick:h=null,onMouseEnter:l=null,onMouseLeave:c=null}=t;return b.WithWindow((t=>{const d=t.document.createElement("div");return d.style.position="fixed",void 0!==n&&(d.style.top=_(n)),void 0!==i&&(d.style.left=_(i)),void 0!==o&&(d.style.right=_(o)),d.style.color=a,d.style.fontSize=_(s),d.style.whiteSpace="pre",d.style.zIndex=m,d.innerHTML=e,d.className=r,d.onclick=h,d.onmouseenter=l,d.onmouseleave=c,t.document.body.appendChild(d),d}))},q={largest:45,large:40,normal:30,small:27,smaller:23,smallest:18},J=class{constructor(t){e(this,"top"),e(this,"menuItems"),e(this,"activeItemIndex"),e(this,"input"),e(this,"menuItemElements",[]),e(this,"setActiveIndex",(t=>{if(this.activeItemIndex!==t){void 0!==this.activeItemIndex&&this.unsetActiveItem(this.activeItemIndex),this.activeItemIndex=t;this.menuItemElements[t].classList.add("activeMenuItem")}})),e(this,"unsetActiveItem",(t=>{if(this.activeItemIndex===t){this.activeItemIndex=void 0;this.menuItemElements[t].classList.remove("activeMenuItem")}})),e(this,"incrActive",(()=>{void 0!==this.activeItemIndex&&this.activeItemIndex<this.menuItems.length-1&&this.setActiveIndex(this.activeItemIndex+1)})),e(this,"decrActive",(()=>{void 0!==this.activeItemIndex&&this.activeItemIndex>=1&&this.setActiveIndex(this.activeItemIndex-1)})),this.input=t.input,this.top=t.top,this.menuItems=t.menuItems.map(((t,e)=>({...t,index:e})))}render(){this.menuItemElements=this.menuItems.map(((t,e)=>{const s=B({text:t.text,fontSize:q.normal,top:this.top+e*J.spaceBetweenMenuItems,onClick:t.onClick,className:"menuItem",onMouseEnter:()=>{this.setActiveIndex(e)}});return X(s),s})),this.setActiveIndex(0),this.input.onKeyUpCallback=t=>{switch(t){case"up":this.decrActive();break;case"down":this.incrActive();break;case"start":case"laser":case"shoot":void 0!==this.activeItemIndex&&this.menuItems[this.activeItemIndex].onClick()}}}destroy(){this.input.onKeyUpCallback=void 0,this.menuItemElements.forEach((t=>{t.remove()})),this.menuItemElements=[],this.activeItemIndex=void 0}};let V=J;e(V,"spaceBetweenMenuItems",25);const j="0.5.0";class K{constructor(t){e(this,"ui"),e(this,"shadeElement"),e(this,"title"),e(this,"menu"),e(this,"version"),e(this,"onStartGame",(()=>{this.ui.SetActiveScene(this.ui.displayControls)})),this.ui=t.ui}render(){this.shadeElement=Y(),this.title=B({text:'<span class="flash3s"><span style="font-size: 76px;">S</span>chmupinator</span>',fontSize:60,top:36}),X(this.title),this.menu=new V({input:this.ui.input,top:108,menuItems:[{text:"start game",onClick:this.onStartGame},{text:"highscore",onClick:()=>{this.ui.SetActiveScene(this.ui.highscore)}},{text:"controls",onClick:()=>{this.ui.SetActiveScene(this.ui.settingsControls)}},{text:"settings",onClick:()=>{this.ui.SetActiveScene(this.ui.settings)}}]}),this.menu.render(),this.version=B({text:j,fontSize:q.smallest,top:225,left:333,color:"rgba(255, 0, 0, 0.4)"})}destroy(){var t,e,s,i;null==(t=this.shadeElement)||t.remove(),this.shadeElement=void 0,null==(e=this.title)||e.remove(),this.title=void 0,null==(s=this.menu)||s.destroy(),null==(i=this.version)||i.remove(),this.version=void 0}}class Q{constructor(t){e(this,"ui"),e(this,"scoreElement"),e(this,"hiscoreElement"),e(this,"onEvent",(t=>{if("uiScoreUpdated"===t.type)this.scoreElement&&(this.scoreElement.innerHTML=`Score ${Math.round(t.points)}`)})),this.ui=t.ui}render(){this.scoreElement=B({text:"Score 0",color:"white",fontSize:q.smallest,top:10,left:20});const t=this.ui.highscoreService.getTop1().score;this.hiscoreElement=B({text:`Record ${t}`,color:"white",fontSize:q.smallest,top:10,left:285}),this.ui.eventsUi.subscribeToEvent("GameUI",this.onEvent)}destroy(){var t,e;null==(t=this.scoreElement)||t.remove(),this.scoreElement=void 0,null==(e=this.hiscoreElement)||e.remove(),this.hiscoreElement=void 0,this.ui.events.unsubscribeToEvent("GameUI")}}class Z{constructor(t){e(this,"interval"),e(this,"originalSecondsLeft"),e(this,"currentSecondsLeft"),e(this,"onDone"),e(this,"input"),e(this,"element"),e(this,"destroy",(()=>{this.input.onKeyUpCallback=void 0,b.WithWindow((t=>{t.clearInterval(this.interval)})),this.element.remove()})),e(this,"tick",(()=>{this.currentSecondsLeft--,this.element.innerHTML=`${this.currentSecondsLeft}`,this.currentSecondsLeft<1&&(this.destroy(),this.onDone())}));const{input:s,secondsLeft:i,onDone:n,fontSize:o=q.smallest,left:r=0,top:a=0,className:h=""}=t;this.input=s,this.originalSecondsLeft=i,this.currentSecondsLeft=i,this.onDone=n,this.element=b.WithWindow((t=>{const e=t.document.createElement("div");return e.style.position="fixed",e.style.top=_(a),e.style.left=_(r),e.style.color="red",e.style.fontSize=_(o),e.style.whiteSpace="pre",e.style.zIndex=m,e.innerHTML=`${i}`,e.className=h,t.document.body.appendChild(e),e})),this.interval=b.SetInterval(this.tick,1e3),this.input.onKeyUpCallback=t=>{switch(t){case"laser":case"shoot":case"start":this.originalSecondsLeft-this.currentSecondsLeft>=1&&(this.destroy(),this.onDone())}}}}class tt{constructor(t){e(this,"ui"),e(this,"shadeElement"),e(this,"textElement"),e(this,"countdown"),e(this,"handleCountdDownDone",(()=>{const t=this.ui.points.points,{qualifiedForTop10:e,rank:s}=this.ui.highscoreService.qualifiedForTop10(t);e?this.ui.SetActiveScene(this.ui.enterHighscore,s):b.WithWindow((t=>{t.location.reload()}))})),this.ui=t.ui}render(){this.shadeElement=Y(),this.textElement=B({text:"Game Over",fontSize:q.largest,top:95}),X(this.textElement),this.countdown=new Z({input:this.ui.input,secondsLeft:5,onDone:this.handleCountdDownDone,fontSize:q.largest,top:130}),X(this.countdown.element)}destroy(){var t,e,s;null==(t=this.shadeElement)||t.remove(),this.shadeElement=void 0,null==(e=this.textElement)||e.remove(),this.textElement=void 0,null==(s=this.countdown)||s.destroy(),this.countdown=void 0}}const et=(t,e)=>{const s=e-t.length;return`${t}${Array(s).fill(" ").join("")}`};class st{constructor(t){e(this,"ui"),e(this,"rank"),e(this,"shadeElement"),e(this,"title"),e(this,"top10"),e(this,"countdown"),e(this,"menu"),e(this,"getTop10Text",(()=>{const t=t=>et(t,10),e=t=>et(t,11);return[t("rank")+e("Score")+"Player",...this.ui.highscoreService.getTop10().map((({name:s,score:i},n)=>{const o=t(`${n+1}`),r=e(`${i}`);return k(this.rank)&&this.rank===n?`<span class="flash1s">${o}${r}${s}</span>`:`${o}${r}${s}`}))].join("\n")})),e(this,"handleCountdDownDone",(()=>{b.WithWindow((t=>{t.location.reload()}))})),this.ui=t.ui}render(t){k(t)&&(this.rank=t),this.shadeElement=Y(),this.title=B({text:"Highscore",fontSize:q.large,top:5}),X(this.title),this.top10=B({text:this.getTop10Text(),fontSize:q.smaller,top:38}),X(this.top10),this.countdown=new Z({input:this.ui.input,secondsLeft:15,onDone:this.handleCountdDownDone,fontSize:q.large,top:5,left:315}),this.menu=new V({input:this.ui.input,top:207,menuItems:[{text:"continue",onClick:this.handleCountdDownDone}]}),this.menu.render()}destroy(){var t,e,s,i,n;null==(t=this.shadeElement)||t.remove(),this.shadeElement=void 0,null==(e=this.title)||e.remove(),this.title=void 0,null==(s=this.top10)||s.remove(),this.top10=void 0,null==(i=this.countdown)||i.destroy(),this.countdown=void 0,null==(n=this.menu)||n.destroy()}}const it=["_","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];class nt{constructor(t){e(this,"top"),e(this,"caretIndex",0),e(this,"charIndices",[0,0,0,0,0,0]),e(this,"onDone"),e(this,"input"),e(this,"charElements",[]),e(this,"getEnteredString",(()=>this.charIndices.map((t=>it[t])).join("").replaceAll("_"," "))),e(this,"updateCurrChar",(()=>{const t=this.charIndices[this.caretIndex];this.charElements[this.caretIndex].innerHTML=it[t]})),e(this,"incrCurrCharIndex",(()=>{this.charIndices[this.caretIndex]++,this.charIndices[this.caretIndex]>it.length-1&&(this.charIndices[this.caretIndex]=0),this.updateCurrChar()})),e(this,"decrCurrCharIndex",(()=>{this.charIndices[this.caretIndex]--,this.charIndices[this.caretIndex]<0&&(this.charIndices[this.caretIndex]=it.length-1),this.updateCurrChar()})),e(this,"setCaretIndex",(t=>{if(this.caretIndex!==t){this.charElements[this.caretIndex].classList.remove("activeMenuItem"),this.caretIndex=t;this.charElements[t].classList.add("activeMenuItem")}})),e(this,"incrCaretIndex",(()=>{void 0!==this.caretIndex&&this.caretIndex<this.charIndices.length-1&&this.setCaretIndex(this.caretIndex+1)})),e(this,"decrCaretIndex",(()=>{void 0!==this.caretIndex&&this.caretIndex>=1&&this.setCaretIndex(this.caretIndex-1)})),this.input=t.input,this.top=t.top,this.onDone=t.onDone}render(){const t=this.charIndices.map((t=>it[t])).map((t=>({text:t}))).map(((t,e)=>({...t,index:e})));this.charElements=t.map(((t,e)=>{const s=q.large;return B({text:t.text,fontSize:s,top:this.top,left:136+e*s*.37,className:"menuItem",onMouseEnter:()=>{this.setCaretIndex(e)}})})),this.setCaretIndex(0),this.input.onKeyUpCallback=t=>{switch(t){case"up":this.incrCurrCharIndex();break;case"down":this.decrCurrCharIndex();break;case"left":this.decrCaretIndex();break;case"right":this.incrCaretIndex();break;case"start":this.onDone(this.getEnteredString())}}}destroy(){this.input.onKeyUpCallback=void 0,this.charElements.forEach((t=>{t.remove()})),this.charElements=[],this.caretIndex=0}}class ot{constructor(t){e(this,"ui"),e(this,"rank"),e(this,"shadeElement"),e(this,"title"),e(this,"subTitle"),e(this,"flipCharacters"),e(this,"onEnteredName",(t=>{this.ui.highscoreService.registerNewEntry({name:t,score:this.ui.points.points}),this.ui.SetActiveScene(this.ui.highscore,this.rank)})),this.ui=t.ui}render(t){k(t)&&(this.rank=t),this.shadeElement=Y(),this.title=B({text:"Made it into the Highscore",fontSize:q.normal,top:20,className:"flash1s"}),X(this.title),this.subTitle=B({text:"Enter thy name and\n become a legend",fontSize:q.small,top:70,className:"flash1s"}),X(this.subTitle),this.flipCharacters=new nt({input:this.ui.input,top:130,onDone:this.onEnteredName}),this.flipCharacters.render()}destroy(){var t,e,s,i;null==(t=this.shadeElement)||t.remove(),this.shadeElement=void 0,null==(e=this.title)||e.remove(),this.title=void 0,null==(s=this.subTitle)||s.remove(),this.subTitle=void 0,null==(i=this.flipCharacters)||i.destroy()}}class rt{constructor(t){e(this,"ui"),e(this,"shadeElement"),e(this,"title"),e(this,"menu"),this.ui=t.ui}render(){const{fullscreen:t,gameSpeedSlider:e,fpsStats:s,outsideHider:i}=this.ui.settingsService.settings;this.shadeElement=Y(),this.title=B({text:'<span class="flash3s"><span style="font-size: 76px;">S</span>ettings</span>',fontSize:60,top:38}),X(this.title),this.menu=new V({input:this.ui.input,top:105,menuItems:[{text:"fullscreen - "+(t?"on":"off"),onClick:()=>{this.ui.settingsService.toggleSetting("fullscreen")}},{text:"fpsStats - "+(s?"on":"off"),onClick:()=>{this.ui.settingsService.toggleSetting("fpsStats")}},{text:"gameSpeedSlider - "+(e?"on":"off"),onClick:()=>{this.ui.settingsService.toggleSetting("gameSpeedSlider")}},{text:"outsideHider - "+(i?"on":"off"),onClick:()=>{this.ui.settingsService.toggleSetting("outsideHider")}},{text:"back",onClick:()=>{this.ui.SetActiveScene(this.ui.startGame)}}]}),this.menu.render()}destroy(){var t,e,s;null==(t=this.shadeElement)||t.remove(),this.shadeElement=void 0,null==(e=this.title)||e.remove(),this.title=void 0,null==(s=this.menu)||s.destroy()}}const at=class{constructor(t){e(this,"top"),e(this,"items"),e(this,"itemElements",[]),this.top=t.top,this.items=t.items}render(){this.itemElements=this.items.map(((t,e)=>{const s=B({text:t.text,fontSize:q.normal,top:this.top+e*at.spaceBetweenItems,className:"listItem"});return X(s),s}))}destroy(){this.itemElements.forEach((t=>{t.remove()})),this.itemElements=[]}};let ht=at;e(ht,"spaceBetweenItems",25);class lt{constructor(t){var s;e(this,"top"),e(this,"list"),this.top=null!=(s=t.top)?s:0}render(){this.list=new ht({top:this.top,items:[{text:"move - arrow keys"},{text:"shoot - space"},{text:"laser - ctrl"},{text:"start - enter"}]}),this.list.render()}destroy(){var t;null==(t=this.list)||t.destroy()}}class ct{constructor(t){e(this,"ui"),e(this,"shadeElement"),e(this,"title"),e(this,"menu"),e(this,"showControls"),this.ui=t.ui}render(){this.shadeElement=Y(),this.title=B({text:'<span class="flash3s"><span style="font-size: 76px;">C</span>ontrols</span>',fontSize:60,top:38}),X(this.title),this.showControls=new lt({top:105}),this.showControls.render(),this.menu=new V({input:this.ui.input,top:205,menuItems:[{text:"back",onClick:()=>{this.ui.SetActiveScene(this.ui.startGame)}}]}),this.menu.render()}destroy(){var t,e,s,i;null==(t=this.shadeElement)||t.remove(),this.shadeElement=void 0,null==(e=this.title)||e.remove(),this.title=void 0,null==(s=this.showControls)||s.destroy(),null==(i=this.menu)||i.destroy()}}class dt{constructor(t){e(this,"ui"),e(this,"shadeElement"),e(this,"countdown"),e(this,"showControls"),e(this,"handleCountdDownDone",(()=>{this.ui.gameLoop.Start(),this.ui.SetActiveScene(this.ui.game)})),this.ui=t.ui}render(){this.shadeElement=Y(),this.countdown=new Z({input:this.ui.input,secondsLeft:6,onDone:this.handleCountdDownDone,fontSize:q.large,top:5,left:315}),this.showControls=new lt({top:80}),this.showControls.render()}destroy(){var t,e,s;null==(t=this.shadeElement)||t.remove(),this.shadeElement=void 0,null==(e=this.countdown)||e.destroy(),this.countdown=void 0,null==(s=this.showControls)||s.destroy()}}class mt{constructor({name:t}){e(this,"name"),e(this,"events"),e(this,"eventsUi"),e(this,"gameLoop"),e(this,"gameSpeed"),e(this,"highscoreService"),e(this,"points"),e(this,"settingsService"),e(this,"input"),e(this,"startGame"),e(this,"settings"),e(this,"game"),e(this,"gameOver"),e(this,"highscore"),e(this,"enterHighscore"),e(this,"settingsControls"),e(this,"displayControls"),e(this,"activeScene"),e(this,"Init",(async t=>{this.events=null==t?void 0:t.events,this.eventsUi=null==t?void 0:t.eventsUi,this.gameLoop=null==t?void 0:t.gameLoop,this.gameSpeed=null==t?void 0:t.gameSpeed,this.highscoreService=null==t?void 0:t.highscore,this.points=null==t?void 0:t.points,this.settingsService=null==t?void 0:t.settings,this.input=null==t?void 0:t.input,this.events.subscribeToEvent(this.name,this.onEvent),this.SetActiveScene(this.startGame)})),e(this,"SetActiveScene",((t,e)=>{t!==this.activeScene?(this.activeScene&&this.activeScene.destroy(),this.activeScene=t,this.activeScene.render(e)):console.warn("Trying to set a scene to active which is already active.")})),e(this,"onEvent",(t=>{switch(t.type){case"frame_tick":this.gameLoop.FrameCount>=3200&&(this.gameSpeed.GameSpeed=0,this.SetActiveScene(this.gameOver));break;case"player_died":this.gameSpeed.GameSpeed=0,this.SetActiveScene(this.gameOver)}})),e(this,"destroy",(()=>{this.startGame.destroy(),this.settings.destroy(),this.game.destroy(),this.gameOver.destroy(),this.highscore.destroy(),this.enterHighscore.destroy(),this.settingsControls.destroy(),this.displayControls.destroy(),this.events.unsubscribeToEvent(this.name),this.activeScene=void 0})),this.name=t,this.startGame=new K({ui:this}),this.settings=new rt({ui:this}),this.game=new Q({ui:this}),this.gameOver=new tt({ui:this}),this.highscore=new st({ui:this}),this.enterHighscore=new ot({ui:this}),this.settingsControls=new ct({ui:this}),this.displayControls=new dt({ui:this})}}class pt{constructor({name:t}){e(this,"name"),e(this,"gameAspectRatio",1.4875),e(this,"Init",(async()=>{})),e(this,"destroy",(()=>{b.WithWindow((t=>{t.removeEventListener("resize",this.setFullscreen),t.document.body.style.transform="none"}))})),e(this,"setFullscreen",(()=>{b.WithWindow((t=>{const e=t.document.body,s=t.document.documentElement.clientWidth,i=t.document.documentElement.clientHeight;if(s/i>this.gameAspectRatio){const t=i/240;let n=0;n=(s-357*t)/2,e.style.transform=`translateX(${n}px) scale(${t})`}else{const t=s/357;e.style.transform=`scale(${t})`}}))})),this.name=t,this.setFullscreen(),b.WithWindow((t=>{t.addEventListener("resize",this.setFullscreen)}))}}class ut{constructor({name:t}){e(this,"name"),e(this,"events"),e(this,"layer1Element"),e(this,"layer2Element"),e(this,"layer3Element"),e(this,"Init",(async t=>{this.events=null==t?void 0:t.events,this.events.subscribeToEvent(this.name,this.onEvent)})),e(this,"onEvent",(t=>{if("frame_tick"!==t.type)return;const e=t.frameNr,s=Math.round(1*e*.3),i=Math.round(1*e),n=Math.round(1*e*1.5);C(this.layer1Element)&&C(this.layer2Element)&&C(this.layer3Element)&&(this.layer1Element.style.backgroundPositionY=_(s),this.layer2Element.style.backgroundPositionY=_(i),this.layer3Element.style.backgroundPositionY=_(n))})),this.name=t,this.layer1Element=b.WithWindow((t=>{const e=t.document.querySelector("#layer1");return e.style.height="240px",e.style.width="357px",e.style.backgroundColor="black",e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.backgroundImage='url("/images/layer1.png")',e.style.backgroundSize="contain",e.style.backgroundOrigin="padding-box",e.style.backgroundRepeat="repeat-y",e.style.backgroundPositionY="0px",e})),this.layer2Element=b.WithWindow((t=>{const e=t.document.querySelector("#layer2");return e.style.height="240px",e.style.width="357px",e.style.backgroundColor="unset",e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.backgroundImage='url("/images/layer2.png")',e.style.backgroundSize="contain",e.style.backgroundOrigin="padding-box",e.style.backgroundRepeat="repeat-y",e.style.backgroundPositionY="0px",e})),this.layer3Element=b.WithWindow((t=>{const e=t.document.querySelector("#layer3");return e.style.height="240px",e.style.width="357px",e.style.backgroundColor="unset",e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.backgroundImage='url("/images/layer3.png")',e.style.backgroundSize="contain",e.style.backgroundOrigin="padding-box",e.style.backgroundRepeat="repeat-y",e.style.backgroundPositionY="0px",e}))}}class yt{constructor({name:t}){e(this,"name"),e(this,"frameCount",0),e(this,"history",{}),e(this,"recordedHistory"),e(this,"startTime",b.PerformanceNow()),e(this,"events"),e(this,"eventsPoints"),e(this,"Init",(async t=>{this.recordedHistory=(await x((()=>import("./e2ehistory.0ec200d3.js")),[])).recordedHistory,this.events=null==t?void 0:t.events,this.eventsPoints=null==t?void 0:t.eventsPoints,this.events.subscribeToEvent(this.name,this.onEvent),this.eventsPoints.subscribeToEvent(this.name,this.onEvent)})),e(this,"onEvent",(t=>{var e;if("player_died"===t.type){console.log("E2eTest: Test succeeded.");const t=(b.PerformanceNow()-this.startTime)/1e3;console.log(`E2eTest: Took ${t} seconds to run test.`),S()||process.exit(0)}if("frame_tick"!==t.type){const s=this.frameCount;void 0===this.history[s]&&(this.history[s]=[]),null==(e=this.history[s])||e.push(t)}if("frame_tick"===t.type){this.frameCount=t.frameNr;const e=t.frameNr-1,s=JSON.stringify(this.recordedHistory[e]),i=JSON.stringify(this.history[e]);s!==i&&b.Alert(`Test failed!\nFrame: ${e}\nExpected: ${s}\nActual: ${i}`)}})),this.name=t}}class gt{constructor({app:t,name:s}){e(this,"name"),e(this,"settings",{fullscreen:!0,gameSpeedSlider:!1,fpsStats:!1,outsideHider:!0}),e(this,"app"),e(this,"Init",(async t=>{})),e(this,"toggleSetting",(t=>{const e=this.settings[t];this.settings[t]=!e,b.WithWindow((t=>{t.localStorage.setItem("__settings",JSON.stringify(this.settings))})),b.WithWindow((t=>{t.location.reload()}))})),this.app=t,this.name=s,b.WithWindow((t=>{const e=t.localStorage.getItem("__settings");e?this.settings=JSON.parse(e):t.localStorage.setItem("__settings",JSON.stringify(this.settings))}))}}class vt{constructor({name:t}){e(this,"name"),e(this,"Init",(async t=>{})),this.name=t,b.WithWindow((t=>{const e=t.document.querySelector("#gameHideBottom");return e.style.height=_(1e3),e.style.width=_(357),e.style.position="fixed",e.style.top=_(240),e.style.left=_(0),e.style.backgroundColor="white",e.style.zIndex=l,e})),b.WithWindow((t=>{const e=t.document.querySelector("#gameHideRight");return e.style.height=_(1e3),e.style.width=_(1e3),e.style.position="fixed",e.style.top=_(0),e.style.left=_(357),e.style.backgroundColor="white",e.style.zIndex=l,e}))}}class ft{constructor({name:t}){e(this,"name"),e(this,"Init",(async()=>{})),e(this,"destroy",(()=>{})),this.name=t}}class wt{constructor({name:t}){e(this,"name"),e(this,"frameCount",0),e(this,"replay"),e(this,"events"),e(this,"Init",(async t=>{this.replay=(await x((()=>import("./replay.0bc10965.js")),[])).replay,this.events=null==t?void 0:t.events,this.events.subscribeToEvent(this.name,(t=>{if("frame_tick"===t.type)this.frameCount=t.frameNr}))})),this.name=t}get ButtonsPressed(){const t=`${this.frameCount}`,e={start:!1,down:!1,left:!1,right:!1,shoot:!1,laser:!1,up:!1};if(!(t in this.replay.inputs))return e;return{...e,...this.replay.inputs[t]}}}class xt{constructor({name:t}){e(this,"name"),e(this,"Init",(async()=>{})),e(this,"Dispatch",(t=>({type:"responseVoid"}))),this.name=t}}class St{constructor({app:t,name:s}){e(this,"app"),e(this,"name"),e(this,"FrameCount"),e(this,"Init",(async()=>{})),e(this,"Start",(()=>{b.SetInterval(this.oneGameLoop,0)})),e(this,"nextFrame",(()=>{0!==this.app.gameSpeed.GameSpeed&&(this.FrameCount++,this.app.events.dispatchEvent({type:"frame_tick",frameNr:this.FrameCount}))})),e(this,"oneGameLoop",(()=>{0!==this.app.gameSpeed.GameSpeed&&this.nextFrame()})),this.app=t,this.name=s,this.FrameCount=0}}class bt{constructor({app:t,name:s}){e(this,"app"),e(this,"name"),e(this,"FrameCount"),e(this,"nextFrameMillis"),e(this,"Init",(async()=>{})),e(this,"Start",(()=>{this.nextFrameMillis=b.PerformanceNow()+16.666666666666668,b.RequestAnimationFrame(this.oneGameLoop)})),e(this,"nextFrame",(()=>{const t=this.app.gameSpeed.GameSpeed;for(let e=0;e<t;e++)this.FrameCount++,this.app.events.dispatchEvent({type:"frame_tick",frameNr:this.FrameCount})})),e(this,"oneGameLoop",(t=>{if(b.RequestAnimationFrame(this.oneGameLoop),null===this.nextFrameMillis)throw b.Alert("this.nextFrameMillis === null"),new Error("this.nextFrameMillis === null");for(;t>=this.nextFrameMillis;)this.nextFrameMillis+=16.666666666666668,this.nextFrame()})),this.app=t,this.name=s,this.FrameCount=0,this.nextFrameMillis=null}}class Et{constructor({app:t,name:s}){e(this,"app"),e(this,"name"),e(this,"pointsService"),e(this,"history"),e(this,"Init",(async()=>{this.history=(await x((()=>import("./pointsHistory.eb25ba8d.js")),[])).recordedHistory,await this.pointsService.Init(),this.app.events.subscribeToEvent(this.name,this.onEvent)})),e(this,"onEvent",(t=>{switch(t.type){case"frame_tick":{const e=t.frameNr,s=this.history[e],i=JSON.stringify(s),n=this.pointsService.history[e],o=JSON.stringify(n);i!==o&&b.Alert(`Test failed!\nFrame: ${e}\nExpected: ${i}\nActual: ${o}`);break}}})),this.app=t,this.name=s,this.pointsService=new z({app:this.app,name:"points"})}get points(){return this.pointsService.points}}class It{constructor({name:t}){e(this,"name"),e(this,"gameSpeed"),e(this,"Init",(async()=>{})),this.name=t,this.gameSpeed=1}get GameSpeed(){return this.gameSpeed}set GameSpeed(t){this.gameSpeed=t}}class kt{constructor({name:t}){e(this,"name"),e(this,"Init",(async()=>{})),this.name=t}}class At{constructor(){e(this,"e2eTest"),e(this,"settings"),e(this,"input"),e(this,"gameLoop"),e(this,"fps"),e(this,"enemies"),e(this,"gamepad"),e(this,"collisions"),e(this,"events"),e(this,"eventsUi"),e(this,"eventsPoints"),e(this,"gameSpeed"),e(this,"points"),e(this,"highscore"),e(this,"yaml"),e(this,"graphics"),e(this,"ui"),e(this,"fullscreen"),e(this,"parallax"),e(this,"outsideHider"),e(this,"Init",(async()=>{const{enemies:t,events:e,eventsPoints:s,eventsUi:i,gameLoop:n,gamepad:o,gameSpeed:r,graphics:a,highscore:h,input:l,points:c,yaml:d,settings:m}=this;await this.yaml.Init(),await this.settings.Init(),await this.e2eTest.Init({events:e,eventsPoints:s}),await this.input.Init({events:e}),await this.gameLoop.Init(),await this.fps.Init(),await this.enemies.Init({events:e,eventsPoints:s,graphics:a,yaml:d,input:l,gamepad:o}),await this.gamepad.Init(),await this.collisions.Init({enemies:t,events:e}),await this.events.Init(),await this.gameSpeed.Init(),await this.points.Init(),await this.graphics.Init(),await this.ui.Init({events:e,eventsUi:i,gameLoop:n,gameSpeed:r,highscore:h,input:l,points:c,settings:m}),await this.highscore.Init(),await this.fullscreen.Init(),await this.parallax.Init({events:e}),await this.outsideHider.Init()})),this.settings=new gt({app:this,name:"settings"});const{fullscreen:t,gameSpeedSlider:s,fpsStats:i,outsideHider:n}=this.settings.settings;this.e2eTest=S()?new ft({name:"e2e"}):new yt({name:"e2e"}),this.input=S()?new W({name:"input"}):new wt({name:"input"}),this.gameLoop=S()?new bt({app:this,name:"gameLoop"}):new St({app:this,name:"nodeGameLoop"}),this.fps=S()&&i?new L({app:this,name:"fps"}):new kt({app:this,name:"fps"}),this.enemies=new H({name:"enemies"}),this.gamepad=new F({name:"gamePad"}),this.collisions=new M({name:"collisions"}),this.events=(S(),new G({app:this,name:"events"})),this.eventsUi=new G({app:this,name:"eventsUi"}),this.eventsPoints=new G({app:this,name:"eventsPoints"}),this.gameSpeed=S()&&s?new $({name:"gameSpeed"}):new It({name:"gameSpeed"}),this.points=S()?new z({app:this,name:"points"}):new Et({app:this,name:"xPointsTester"}),this.highscore=new R({name:"highscore"}),this.yaml=new N({name:"yaml"}),this.graphics=S()?new U({name:"graphics"}):new xt({name:"mockGraphics"}),this.ui=S()?new mt({name:"ui"}):new ft({name:"mockUi"}),this.fullscreen=S()&&t?new pt({name:"fullscreen"}):new ft({name:"fullscreen"}),this.parallax=S()?new ut({name:"parallax"}):new ft({name:"parallax"}),this.outsideHider=S()&&n?new vt({name:"hider"}):new ft({name:"hider"})}}b.OnLoad((async()=>{const t=new At;await t.Init(),S()||t.gameLoop.Start()}));
